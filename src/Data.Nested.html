<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ConstraintKinds        #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE DataKinds              #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE DeriveFoldable         #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE DeriveFunctor          #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE DeriveTraversable      #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts       #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances      #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE FunctionalDependencies #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE GADTs                  #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE InstanceSigs           #-}</span><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# LANGUAGE KindSignatures         #-}</span><span>
</span><a name="line-12"></a><span class="hs-pragma">{-# LANGUAGE LambdaCase             #-}</span><span>
</span><a name="line-13"></a><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses  #-}</span><span>
</span><a name="line-14"></a><span class="hs-pragma">{-# LANGUAGE PolyKinds              #-}</span><span>
</span><a name="line-15"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables    #-}</span><span>
</span><a name="line-16"></a><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving     #-}</span><span>
</span><a name="line-17"></a><span class="hs-pragma">{-# LANGUAGE TypeApplications       #-}</span><span>
</span><a name="line-18"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies           #-}</span><span>
</span><a name="line-19"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilyDependencies #-}</span><span>
</span><a name="line-20"></a><span class="hs-pragma">{-# LANGUAGE TypeInType             #-}</span><span>
</span><a name="line-21"></a><span class="hs-pragma">{-# LANGUAGE TypeOperators          #-}</span><span>
</span><a name="line-22"></a><span class="hs-pragma">{-# LANGUAGE UndecidableInstances   #-}</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Nested</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">DeepSeq</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Kind</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Singletons</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Singletons</span><span class="hs-operator">.</span><span class="hs-identifier">Prelude</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Length</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Reverse</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">%:++</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sReverse</span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Combinator</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Type.Combinator.Util.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Combinator</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Index</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Length</span><span>                    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCL</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Type.Length.Util.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Length</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>               </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCL</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Product</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Type.Product.Util.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Product</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Type.Sing.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Sing</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Type.SnocProd.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">SnocProd</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.Type.Uniform.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Uniform</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Class</span><span class="hs-operator">.</span><span class="hs-identifier">Witness</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Family</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span>           </span><a href="Type.Family.List.Util.html"><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Family</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span>           </span><a href="Type.NatKind.html"><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">NatKind</span></a><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Singletons</span><span class="hs-operator">.</span><span class="hs-identifier">TypeLits</span><span>            </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">GT</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Nat</span><span>                       </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCN</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span>                    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCV</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Data.Type.Vector.Util.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span class="hs-operator">.</span><span class="hs-identifier">Util</span></a><span>               </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TCV</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Data.Vector.Sized.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span class="hs-operator">.</span><span class="hs-identifier">Sized</span></a><span>                   </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">VS</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-keyword">data</span><span> </span><a name="Uncons"><a href="Data.Nested.html#Uncons"><span class="hs-identifier">Uncons</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627579148"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579148"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-52"></a><span>    </span><a name="UNil"><a href="Data.Nested.html#UNil"><span class="hs-identifier">UNil</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Data.Nested.html#Uncons"><span class="hs-identifier hs-type">Uncons</span></a><span> </span><a href="#local-1627579149"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-special">(</span><a href="Type.NatKind.html#FromNat"><span class="hs-identifier hs-type">FromNat</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><a href="#local-1627579150"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-53"></a><span>    </span><a name="UCons"><a href="Data.Nested.html#UCons"><span class="hs-identifier">UCons</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><a href="#local-1627579151"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579152"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579153"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627579151"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-1627579152"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#Uncons"><span class="hs-identifier hs-type">Uncons</span></a><span> </span><a href="#local-1627579153"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-special">(</span><a href="Type.NatKind.html#Succ"><span class="hs-identifier hs-type">Succ</span></a><span> </span><a href="#local-1627579151"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627579152"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span class="hs-keyword">class</span><span> </span><a href="Type.NatKind.html#NatKind"><span class="hs-identifier hs-type">NatKind</span></a><span> </span><a href="#local-1627579127"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="Vec"><a href="Data.Nested.html#Vec"><span class="hs-identifier">Vec</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627579128"><a href="#local-1627579128"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627579127"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-56"></a><span>    </span><span class="hs-identifier">vHead</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627579129"><span class="hs-identifier hs-type">p</span></a><span> </span><a href="#local-1627579130"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579128"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-special">(</span><a href="Type.NatKind.html#Succ"><span class="hs-identifier hs-type">Succ</span></a><span> </span><a href="#local-1627579130"><span class="hs-identifier hs-type">j</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627579131"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579131"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-57"></a><span>    </span><span class="hs-identifier">vTail</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627579128"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-special">(</span><a href="Type.NatKind.html#Succ"><span class="hs-identifier hs-type">Succ</span></a><span> </span><a href="#local-1627579132"><span class="hs-identifier hs-type">j</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627579133"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579128"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627579132"><span class="hs-identifier hs-type">j</span></a><span> </span><a href="#local-1627579133"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-58"></a><span>    </span><span class="hs-identifier">vGenA</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="#local-1627579134"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><a href="#local-1627579135"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Type.NatKind.html#IndexN"><span class="hs-identifier hs-type">IndexN</span></a><span> </span><a href="#local-1627579127"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627579135"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579134"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-1627579136"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579134"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627579128"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627579135"><span class="hs-identifier hs-type">j</span></a><span> </span><a href="#local-1627579136"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span>    </span><span class="hs-identifier">vIndex</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Type.NatKind.html#IndexN"><span class="hs-identifier hs-type">IndexN</span></a><span> </span><a href="#local-1627579127"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627579137"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579128"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627579137"><span class="hs-identifier hs-type">j</span></a><span> </span><a href="#local-1627579138"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579138"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-60"></a><span>    </span><span class="hs-identifier">vUncons</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><a href="#local-1627579139"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579128"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627579139"><span class="hs-identifier hs-type">j</span></a><span> </span><a href="#local-1627579140"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#Uncons"><span class="hs-identifier hs-type">Uncons</span></a><span> </span><a href="#local-1627579128"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627579139"><span class="hs-identifier hs-type">j</span></a><span> </span><a href="#local-1627579140"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-61"></a><span>    </span><span class="hs-identifier">vEmpty</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627579128"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-special">(</span><a href="Type.NatKind.html#FromNat"><span class="hs-identifier hs-type">FromNat</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><a href="#local-1627579141"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-62"></a><span>    </span><span class="hs-identifier">vCons</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627579142"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579128"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627579143"><span class="hs-identifier hs-type">j</span></a><span> </span><a href="#local-1627579142"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579128"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-special">(</span><a href="Type.NatKind.html#Succ"><span class="hs-identifier hs-type">Succ</span></a><span> </span><a href="#local-1627579143"><span class="hs-identifier hs-type">j</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627579142"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-63"></a><span>    </span><span class="hs-identifier">vITraverse</span><span>
</span><a name="line-64"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="#local-1627579144"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-65"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Type.NatKind.html#IndexN"><span class="hs-identifier hs-type">IndexN</span></a><span> </span><a href="#local-1627579127"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627579145"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579146"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579144"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-1627579147"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579128"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627579145"><span class="hs-identifier hs-type">j</span></a><span> </span><a href="#local-1627579146"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-67"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579144"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627579128"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627579145"><span class="hs-identifier hs-type">j</span></a><span> </span><a href="#local-1627579147"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-identifier">vGen</span><span>
</span><a name="line-70"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Data.Nested.html#Vec"><span class="hs-identifier hs-type">Vec</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627579250"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627579252"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><a href="#local-1627579251"><span class="hs-identifier hs-type">j</span></a><span>
</span><a name="line-72"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Type.NatKind.html#IndexN"><span class="hs-identifier hs-type">IndexN</span></a><span> </span><a href="#local-1627579252"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627579251"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579253"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-73"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579250"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627579251"><span class="hs-identifier hs-type">j</span></a><span> </span><a href="#local-1627579253"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-74"></a><a name="vGen"><a href="Data.Nested.html#vGen"><span class="hs-identifier">vGen</span></a></a><span> </span><a name="local-1627579254"><a href="#local-1627579254"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627579255"><a href="#local-1627579255"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getI</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Nested.html#vGenA"><span class="hs-identifier hs-var">vGenA</span></a><span> </span><a href="#local-1627579254"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627579255"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span class="hs-keyword">instance</span><span> </span><a href="Data.Nested.html#Vec"><span class="hs-identifier hs-type">Vec</span></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><a href="Data.Vector.Sized.html#VectorT"><span class="hs-identifier hs-type">VS</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VectorT</span></a><span> </span><span class="hs-identifier hs-type">I</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-77"></a><span>    </span><a name="local-1912791744"><a href="Data.Nested.html#vHead"><span class="hs-identifier">vHead</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getI</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Vector.Sized.html#head"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">head</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getFlip2</span><span>
</span><a name="line-78"></a><span>    </span><a name="local-1912791745"><a href="Data.Nested.html#vTail"><span class="hs-identifier">vTail</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Vector.Sized.html#tail"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">tail</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getFlip2</span><span>
</span><a name="line-79"></a><span>    </span><a name="local-1912791746"><a href="Data.Nested.html#vGenA"><span class="hs-identifier">vGenA</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-keyword">case</span><span>
</span><a name="line-80"></a><span>      </span><span class="hs-identifier hs-var">GT</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">SNat</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Data.Vector.Sized.html#generateA"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">generateA</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">I</span><span> </span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span>
</span><a name="line-81"></a><span>    </span><a name="local-1912791747"><a href="Data.Nested.html#vIndex"><span class="hs-identifier">vIndex</span></a></a><span> </span><a name="local-1627579436"><a href="#local-1627579436"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Vector.Sized.html#%21%21"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.!!</span></a><span> </span><a href="#local-1627579436"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getFlip2</span><span>
</span><a name="line-82"></a><span>    </span><a name="local-1912791748"><a href="Data.Nested.html#vUncons"><span class="hs-identifier">vUncons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-keyword">case</span><span>
</span><a name="line-83"></a><span>      </span><span class="hs-identifier hs-var">GT</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">SNat</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span class="hs-keyword">case</span><span>
</span><a name="line-84"></a><span>        </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><a name="local-1627579437"><a href="#local-1627579437"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Data.Vector.Sized.html#uncons"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">uncons</span></a><span> </span><a href="#local-1627579437"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-85"></a><span>          </span><a href="Data.Vector.Sized.html#VNil"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">VNil</span></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#UNil"><span class="hs-identifier hs-var">UNil</span></a><span>
</span><a name="line-86"></a><span>          </span><a href="Data.Vector.Sized.html#VCons"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">VCons</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I</span><span> </span><a name="local-1627579438"><a href="#local-1627579438"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627579439"><a href="#local-1627579439"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#UCons"><span class="hs-identifier hs-var">UCons</span></a><span> </span><span class="hs-identifier hs-var">sing</span><span> </span><a href="#local-1627579438"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><a href="#local-1627579439"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-87"></a><span>    </span><a name="local-1912791749"><a href="Data.Nested.html#vEmpty"><span class="hs-identifier">vEmpty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><a href="Data.Vector.Sized.html#empty"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-88"></a><span>    </span><a name="local-1912791750"><a href="Data.Nested.html#vCons"><span class="hs-identifier">vCons</span></a></a><span> </span><a name="local-1627579440"><a href="#local-1627579440"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><a name="local-1627579441"><a href="#local-1627579441"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-special">(</span><a href="Data.Vector.Sized.html#cons"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">cons</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I</span><span> </span><a href="#local-1627579440"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627579441"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-89"></a><span>    </span><a name="local-1912791751"><a href="Data.Nested.html#vITraverse"><span class="hs-identifier">vITraverse</span></a></a><span> </span><a name="local-1627579442"><a href="#local-1627579442"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><a name="local-1627579443"><a href="#local-1627579443"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Data.Vector.Sized.html#itraverse"><span class="hs-identifier hs-var">VS</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">itraverse</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627579444"><a href="#local-1627579444"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I</span><span> </span><a name="local-1627579445"><a href="#local-1627579445"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">I</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627579442"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627579444"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627579445"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627579443"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-keyword">instance</span><span> </span><a href="Data.Nested.html#Vec"><span class="hs-identifier hs-type">Vec</span></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><span class="hs-identifier hs-type">TCV</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VecT</span><span> </span><span class="hs-identifier hs-type">I</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-92"></a><span>    </span><a name="local-1912791744"><a href="Data.Nested.html#vHead"><span class="hs-identifier">vHead</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getI</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">TCV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">head'</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getFlip2</span><span>
</span><a name="line-93"></a><span>    </span><a name="local-1912791745"><a href="Data.Nested.html#vTail"><span class="hs-identifier">vTail</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">TCV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">tail'</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getFlip2</span><span>
</span><a name="line-94"></a><span>    </span><a name="local-1912791746"><a href="Data.Nested.html#vGenA"><span class="hs-identifier">vGenA</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-keyword">case</span><span>
</span><a name="line-95"></a><span>      </span><a href="Data.Type.Sing.html#SN"><span class="hs-identifier hs-var">SN</span></a><span> </span><a name="local-1627579424"><a href="#local-1627579424"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><a name="local-1627579425"><a href="#local-1627579425"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Data.Type.Vector.Util.html#vgenA"><span class="hs-identifier hs-var">TCV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">vgenA</span></a><span> </span><a href="#local-1627579424"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">I</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627579425"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span>    </span><a name="local-1912791747"><a href="Data.Nested.html#vIndex"><span class="hs-identifier">vIndex</span></a></a><span> </span><a name="local-1627579426"><a href="#local-1627579426"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">TCV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">index'</span><span> </span><a href="#local-1627579426"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getFlip2</span><span>
</span><a name="line-97"></a><span>    </span><a name="local-1912791748"><a href="Data.Nested.html#vUncons"><span class="hs-identifier">vUncons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-keyword">case</span><span>
</span><a name="line-98"></a><span>      </span><a href="Data.Type.Sing.html#SN"><span class="hs-identifier hs-var">SN</span></a><span> </span><span class="hs-identifier hs-var">TCN</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Z_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span class="hs-keyword">case</span><span>
</span><a name="line-99"></a><span>        </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-identifier hs-var">TCV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">&#216;V</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#UNil"><span class="hs-identifier hs-var">UNil</span></a><span>
</span><a name="line-100"></a><span>      </span><a href="Data.Type.Sing.html#SN"><span class="hs-identifier hs-var">SN</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TCN</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">S_</span><span> </span><a name="local-1627579427"><a href="#local-1627579427"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">\</span><span class="hs-keyword">case</span><span>
</span><a name="line-101"></a><span>        </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I</span><span> </span><a name="local-1627579428"><a href="#local-1627579428"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier hs-var">TCV</span><span class="hs-operator hs-var">.:*</span><span> </span><a name="local-1627579429"><a href="#local-1627579429"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#UCons"><span class="hs-identifier hs-var">UCons</span></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Sing.html#SN"><span class="hs-identifier hs-var">SN</span></a><span> </span><a href="#local-1627579427"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627579428"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><a href="#local-1627579429"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-102"></a><span>    </span><a name="local-1912791749"><a href="Data.Nested.html#vEmpty"><span class="hs-identifier">vEmpty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-identifier hs-var">TCV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">&#216;V</span><span>
</span><a name="line-103"></a><span>    </span><a name="local-1912791750"><a href="Data.Nested.html#vCons"><span class="hs-identifier">vCons</span></a></a><span> </span><a name="local-1627579430"><a href="#local-1627579430"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><a name="local-1627579431"><a href="#local-1627579431"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I</span><span> </span><a href="#local-1627579430"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-identifier hs-var">TCV</span><span class="hs-operator hs-var">.:*</span><span> </span><a href="#local-1627579431"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-104"></a><span>    </span><a name="local-1912791751"><a href="Data.Nested.html#vITraverse"><span class="hs-identifier">vITraverse</span></a></a><span> </span><a name="local-1627579432"><a href="#local-1627579432"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><a name="local-1627579433"><a href="#local-1627579433"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-var">Flip2</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">TCV</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">itraverse</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627579434"><a href="#local-1627579434"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I</span><span> </span><a name="local-1627579435"><a href="#local-1627579435"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">I</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627579432"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627579434"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627579435"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627579433"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-keyword">class</span><span> </span><a name="Nesting"><a href="Data.Nested.html#Nesting"><span class="hs-identifier">Nesting</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627579121"><a href="#local-1627579121"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627579120"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627579123"><a href="#local-1627579123"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627579122"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Constraint</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627579124"><a href="#local-1627579124"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627579120"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579122"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579122"><span class="hs-identifier hs-type">j</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-107"></a><span>    </span><span class="hs-identifier">nesting</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627579121"><span class="hs-identifier hs-type">w</span></a><span> </span><a href="#local-1627579125"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579123"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-1627579126"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-operator">:-</span><span> </span><a href="#local-1627579123"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627579124"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627579125"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-1627579126"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span class="hs-keyword">class</span><span> </span><a name="Nesting1"><a href="Data.Nested.html#Nesting1"><span class="hs-identifier">Nesting1</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627579115"><a href="#local-1627579115"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627579114"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627579117"><a href="#local-1627579117"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627579116"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Constraint</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627579118"><a href="#local-1627579118"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627579114"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627579116"><span class="hs-identifier hs-type">j</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-110"></a><span>    </span><span class="hs-identifier">nesting1</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627579115"><span class="hs-identifier hs-type">w</span></a><span> </span><a href="#local-1627579119"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Wit</span><span> </span><span class="hs-special">(</span><a href="#local-1627579117"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627579118"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627579119"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span class="hs-keyword">instance</span><span> </span><a href="Data.Nested.html#Nesting"><span class="hs-identifier hs-type">Nesting</span></a><span> </span><a href="#local-1627579423"><span class="hs-identifier hs-type">w</span></a><span> </span><span class="hs-identifier hs-type">NFData</span><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><a href="Data.Vector.Sized.html#VectorT"><span class="hs-identifier hs-type">VS</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VectorT</span></a><span> </span><span class="hs-identifier hs-type">I</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-113"></a><span>    </span><a name="local-1912791742"><a href="Data.Nested.html#nesting"><span class="hs-identifier">nesting</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Sub</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-114"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-1627579421"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><a href="#local-1627579422"><span class="hs-identifier hs-type">w</span></a><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><a href="Data.Vector.Sized.html#VectorT"><span class="hs-identifier hs-type">VS</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VectorT</span></a><span> </span><a href="#local-1627579421"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-115"></a><span>    </span><a name="local-1912791740"><a href="Data.Nested.html#nesting1"><span class="hs-identifier">nesting1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-116"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="#local-1627579420"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><a href="Data.Vector.Sized.html#VectorT"><span class="hs-identifier hs-type">VS</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VectorT</span></a><span> </span><a href="#local-1627579420"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-117"></a><span>    </span><a name="local-1912791740"><a href="Data.Nested.html#nesting1"><span class="hs-identifier">nesting1</span></a></a><span> </span><span class="hs-identifier hs-var">GT</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">SNat</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-118"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Foldable</span><span> </span><a href="#local-1627579418"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><a href="#local-1627579419"><span class="hs-identifier hs-type">w</span></a><span> </span><span class="hs-identifier hs-type">Foldable</span><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><a href="Data.Vector.Sized.html#VectorT"><span class="hs-identifier hs-type">VS</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VectorT</span></a><span> </span><a href="#local-1627579418"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-119"></a><span>    </span><a name="local-1912791740"><a href="Data.Nested.html#nesting1"><span class="hs-identifier">nesting1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-120"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Traversable</span><span> </span><a href="#local-1627579416"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><a href="#local-1627579417"><span class="hs-identifier hs-type">w</span></a><span> </span><span class="hs-identifier hs-type">Traversable</span><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><a href="Data.Vector.Sized.html#VectorT"><span class="hs-identifier hs-type">VS</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VectorT</span></a><span> </span><a href="#local-1627579416"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-121"></a><span>    </span><a name="local-1912791740"><a href="Data.Nested.html#nesting1"><span class="hs-identifier">nesting1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-keyword">instance</span><span> </span><a href="Data.Nested.html#Nesting"><span class="hs-identifier hs-type">Nesting</span></a><span> </span><a href="#local-1627579415"><span class="hs-identifier hs-type">w</span></a><span> </span><span class="hs-identifier hs-type">NFData</span><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><span class="hs-identifier hs-type">TCV</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VecT</span><span> </span><span class="hs-identifier hs-type">I</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-125"></a><span>    </span><a name="local-1912791742"><a href="Data.Nested.html#nesting"><span class="hs-identifier">nesting</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Sub</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-126"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-1627579413"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><a href="#local-1627579414"><span class="hs-identifier hs-type">w</span></a><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><span class="hs-identifier hs-type">TCV</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VecT</span><span> </span><a href="#local-1627579413"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-127"></a><span>    </span><a name="local-1912791740"><a href="Data.Nested.html#nesting1"><span class="hs-identifier">nesting1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-128"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="#local-1627579411"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><span class="hs-identifier hs-type">Sing</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><span class="hs-identifier hs-type">TCV</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VecT</span><span> </span><a href="#local-1627579411"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-129"></a><span>    </span><a name="local-1912791740"><a href="Data.Nested.html#nesting1"><span class="hs-identifier">nesting1</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.Type.Sing.html#SN"><span class="hs-identifier hs-var">SN</span></a><span> </span><a name="local-1627579412"><a href="#local-1627579412"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Wit</span><span> </span><span class="hs-operator hs-var">\\</span><span> </span><a href="#local-1627579412"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-130"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Foldable</span><span> </span><a href="#local-1627579409"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><a href="#local-1627579410"><span class="hs-identifier hs-type">w</span></a><span> </span><span class="hs-identifier hs-type">Foldable</span><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><span class="hs-identifier hs-type">TCV</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VecT</span><span> </span><a href="#local-1627579409"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-131"></a><span>    </span><a name="local-1912791740"><a href="Data.Nested.html#nesting1"><span class="hs-identifier">nesting1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-132"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Traversable</span><span> </span><a href="#local-1627579407"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><a href="#local-1627579408"><span class="hs-identifier hs-type">w</span></a><span> </span><span class="hs-identifier hs-type">Traversable</span><span> </span><span class="hs-special">(</span><a href="Data.Type.Combinator.Util.html#Flip2"><span class="hs-identifier hs-type">Flip2</span></a><span> </span><span class="hs-identifier hs-type">TCV</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">VecT</span><span> </span><a href="#local-1627579407"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-133"></a><span>    </span><a name="local-1912791740"><a href="Data.Nested.html#nesting1"><span class="hs-identifier">nesting1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-134"></a><span>
</span><a name="line-135"></a><span class="hs-comment">-- class Nesting1 (w :: k -&gt; Type) (c :: j -&gt; Constraint) (v :: k -&gt; j) where</span><span>
</span><a name="line-136"></a><span class="hs-identifier">nesting1Every</span><span>
</span><a name="line-137"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627579244"><a href="#local-1627579244"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627579245"><a href="#local-1627579245"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-1627579246"><a href="#local-1627579246"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-1627579247"><a href="#local-1627579247"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-keyword">as</span><span class="hs-operator">.</span><span> </span><a href="Data.Nested.html#Nesting1"><span class="hs-identifier hs-type">Nesting1</span></a><span> </span><a href="#local-1627579245"><span class="hs-identifier hs-type">w</span></a><span> </span><a href="#local-1627579246"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-1627579247"><span class="hs-identifier hs-type">v</span></a><span>
</span><a name="line-138"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627579244"><span class="hs-identifier hs-type">p</span></a><span> </span><a href="#local-1627579247"><span class="hs-identifier hs-type">v</span></a><span>
</span><a name="line-139"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Prod</span><span> </span><a href="#local-1627579245"><span class="hs-identifier hs-type">w</span></a><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-140"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Wit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Every</span><span> </span><a href="#local-1627579246"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627579247"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-141"></a><a name="nesting1Every"><a href="Data.Nested.html#nesting1Every"><span class="hs-identifier">nesting1Every</span></a></a><span> </span><a name="local-1627579256"><a href="#local-1627579256"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-keyword">case</span><span>
</span><a name="line-142"></a><span>    </span><span class="hs-identifier hs-var">&#216;</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>
</span><a name="line-143"></a><span>    </span><span class="hs-special">(</span><a name="local-1627579258"><a href="#local-1627579258"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627579245"><span class="hs-identifier hs-type">w</span></a><span> </span><a href="#local-1627579257"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">:&lt;</span><span> </span><span class="hs-special">(</span><a name="local-1627579260"><a href="#local-1627579260"><span class="hs-identifier">ws</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Prod</span><span> </span><a href="#local-1627579245"><span class="hs-identifier hs-type">w</span></a><span> </span><a href="#local-1627579259"><span class="hs-identifier hs-type">as'</span></a><span class="hs-special">)</span><span>
</span><a name="line-144"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Wit</span><span>  </span><span class="hs-operator hs-var">\\</span><span> </span><span class="hs-special">(</span><a href="Data.Nested.html#nesting1"><span class="hs-identifier hs-var">nesting1</span></a><span> </span><a href="#local-1627579258"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Wit</span><span> </span><span class="hs-special">(</span><a href="#local-1627579246"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627579247"><span class="hs-identifier hs-type">v</span></a><span> </span><a href="#local-1627579257"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-145"></a><span>                </span><span class="hs-operator hs-var">\\</span><span> </span><span class="hs-special">(</span><a href="Data.Nested.html#nesting1Every"><span class="hs-identifier hs-var">nesting1Every</span></a><span> </span><a href="#local-1627579256"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627579260"><span class="hs-identifier hs-var">ws</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Wit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Every</span><span> </span><a href="#local-1627579246"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627579247"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><a href="#local-1627579259"><span class="hs-identifier hs-type">as'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span class="hs-keyword">data</span><span> </span><a name="Nested"><a href="Data.Nested.html#Nested"><span class="hs-identifier">Nested</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627579107"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-1627579107"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-148"></a><span>    </span><a name="N%D8"><a href="Data.Nested.html#N%D8"><span class="hs-identifier">N&#216;</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627579108"><span class="hs-identifier hs-type">a</span></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Nested.html#Nested"><span class="hs-identifier hs-type">Nested</span></a><span> </span><a href="#local-1627579109"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-char">'[]       a
    NS :: v j (Nested v js a) -&gt; Nested v (j ': js) a

instance (NFData a, Nesting Proxy NFData v) =&gt; NFData (Nested v js a) where
    rnf = \case
      N&#216; x  -&gt; deepseq x  ()
      NS (xs :: v j (Nested v ks a))
            -&gt; deepseq xs ()
                 \\ (nesting Proxy :: NFData (Nested v ks a) :- NFData (v j (Nested v ks a)))

-- deriving instance ListC (Show &lt;$&gt; ((v &lt;$&gt; js) &lt;&amp;&gt; a)) =&gt; Show (Nested v js a)

instance (Num a, Applicative (Nested v js)) =&gt; Num (Nested v js a) where
    (+)         = liftA2 (+)
    (*)         = liftA2 (*)
    (-)         = liftA2 (-)
    negate      = fmap negate
    abs         = fmap abs
    signum      = fmap signum
    fromInteger = pure . fromInteger

instance Nesting1 Proxy Functor v =&gt; Functor (Nested v js) where
    fmap f = \case
      N&#216; x  -&gt; N&#216; (f x)
      NS (xs :: v j (Nested v ks a))
            -&gt; NS $ (fmap.fmap) f xs
                      \\ (nesting1 Proxy :: Wit (Functor (v j)))

instance (SingI js, Nesting1 Sing Applicative v, Nesting1 Proxy Functor v) =&gt; Applicative (Nested v js) where
    pure :: forall a. a -&gt; Nested v js a
    pure x = go sing
      where
        go  :: Sing ks
            -&gt; Nested v ks a
        go = \case
          SNil     -&gt; N&#216; x
          (s :: Sing k) `SCons` ss -&gt; NS (pure (go ss))
                    \\ (nesting1 s :: Wit (Applicative (v k)))
    (&lt;*&gt;) :: forall a b. Nested v js (a -&gt; b) -&gt; Nested v js a -&gt; Nested v js b
    (&lt;*&gt;) = go sing
      where
        go  :: Sing ks
            -&gt; Nested v ks (a -&gt; b)
            -&gt; Nested v ks a
            -&gt; Nested v ks b
        go = \case
          SNil -&gt; \case
            N&#216; f -&gt; \case
              N&#216; x -&gt; N&#216; (f x)
          (s :: Sing k) `SCons` ss -&gt; \case
            NS fs -&gt; \case
              NS xs -&gt; NS $ liftA2 (go ss) fs xs
                              \\ (nesting1 s :: Wit (Applicative (v k)))

instance Nesting1 Proxy Foldable v =&gt; Foldable (Nested v js) where
    foldMap f = \case
      N&#216; x  -&gt; f x
      NS (xs :: v j (Nested v ks a))
            -&gt; (foldMap . foldMap) f xs
                 \\ (nesting1 Proxy :: Wit (Foldable (v j)))

instance (Nesting1 Proxy Functor v, Nesting1 Proxy Foldable v, Nesting1 Proxy Traversable v) =&gt; Traversable (Nested v js) where
    traverse f = \case
      N&#216; x  -&gt; N&#216; &lt;$&gt; f x
      NS (xs :: v j (Nested v ks a))
            -&gt; NS &lt;$&gt; (traverse . traverse) f xs
                 \\ (nesting1 Proxy :: Wit (Traversable (v j)))


nHead
    :: forall v p j js a. Vec v
    =&gt; p j
    -&gt; Nested v (Succ j ': js) a
    -&gt; Nested v js a
nHead p = \case
  NS xs -&gt; vHead p xs

nTail
    :: Vec v
    =&gt; Nested v (Succ j ': js) a
    -&gt; Nested v (j ': js) a
nTail = \case
  NS xs -&gt; NS $ vTail xs

unScalar
    :: Nested v '[] a
    -&gt; a
unScalar = \case
  N&#216; x -&gt; x

unVector
    :: Functor (v j)
    =&gt; Nested v '[j] a
    -&gt; v j a
unVector = \case
    NS xs -&gt; unScalar &lt;$&gt; xs

nVector
    :: Functor (v j)
    =&gt; v j a
    -&gt; Nested v '[j] a
nVector = NS . fmap N&#216;

-- genNestedVec
--     :: Vec (v :: k -&gt; Type -&gt; Type)
--     =&gt; Sing ns
--     -&gt; (Prod (IndexN k) ns -&gt; a)
--     -&gt; Nested v ns a
-- genNestedVec = \case
--     SNil         -&gt; \f -&gt; N&#216; (f &#216;)
--     s `SCons` ss -&gt; \f -&gt; NS $ vGen s (\i -&gt; genNestedVec ss (f . (i :&lt;)))

genNestedVec
    :: Vec (v :: k -&gt; Type -&gt; Type)
    =&gt; Sing ns
    -&gt; (Prod (IndexN k) ns -&gt; a)
    -&gt; Nested v ns a
genNestedVec s f = getI $ genNestedVecA s (I . f)

genNestedVecA
    :: (Vec (v :: k -&gt; Type -&gt; Type), Applicative f)
    =&gt; Sing ns
    -&gt; (Prod (IndexN k) ns -&gt; f a)
    -&gt; f (Nested v ns a)
genNestedVecA = \case
    SNil         -&gt; \f -&gt; N&#216; &lt;$&gt; f &#216;
    s `SCons` ss -&gt; \f -&gt; NS &lt;$&gt; vGenA s (\i -&gt; genNestedVecA ss (f . (i :&lt;)))

indexNestedVec
    :: Vec (v :: k -&gt; Type -&gt; Type)
    =&gt; Prod (IndexN k) ns
    -&gt; Nested v ns a
    -&gt; a
indexNestedVec = \case
    &#216; -&gt; \case
      N&#216; x  -&gt; x
    i :&lt; is -&gt; \case
      NS xs -&gt; indexNestedVec is (vIndex i xs)

joinNestedVec
    :: forall v ns ms a. Nesting1 Proxy Functor v
    =&gt; Nested v ns (Nested v ms a)
    -&gt; Nested v (ns ++ ms) a
joinNestedVec = \case
    N&#216; x  -&gt; x
    NS (xs :: v j (Nested v js (Nested v ms a))) -&gt;
      NS $ fmap joinNestedVec xs
        \\ (nesting1 Proxy :: Wit (Functor (v j)))

unjoinNestedVec
    :: Nesting1 Proxy Functor v
    =&gt; Length ns
    -&gt; Nested v (ns ++ ms) a
    -&gt; Nested v ns (Nested v ms a)
unjoinNestedVec = mapNVecSlices id

mapNVecSlices
    :: forall v ns ms a b. Nesting1 Proxy Functor v
    =&gt; (Nested v ms a -&gt; b)
    -&gt; Length ns
    -&gt; Nested v (ns ++ ms) a
    -&gt; Nested v ns b
mapNVecSlices f = \case
    LZ -&gt; N&#216; . f
    LS l -&gt; \case
      NS (xs :: v j (Nested v js a)) -&gt;
        NS $ mapNVecSlices f l &lt;$&gt; xs
          \\ (nesting1 Proxy :: Wit (Functor (v j)))

reduceTrace
    :: forall ns ms v a.
     ( Num a
     , SingI (Reverse ns ++ ms)
     , Nesting1 Proxy Functor v
     , Nesting1 Proxy Foldable v
     , Nesting1 Sing  Applicative v
     , Vec v
     )
    =&gt; Length ns
    -&gt; Length ms
    -&gt; Nested v ns (Nested v (Reverse ns ++ ms) a)
    -&gt; Nested v ms a
reduceTrace lN _ = reduceTraceHelp (reverseSnocProd sN) (prodSing sM)
                     \\ reverseReverse lN
  where
    slN :: SnocLength ns
    slN = snocLength lN
    sN :: Prod Sing (Reverse ns)
    sM :: Prod Sing ms
    (sN, sM) = splitProd (snocLengthReverse slN) (singProd sing)

reduceTraceHelp
    :: forall ns ms v a.
     ( Num a
     , Vec v
     , Nesting1 Proxy Functor     v
     , Nesting1 Proxy Foldable    v
     , Nesting1 Sing  Applicative v
     )
    =&gt; SnocProd Sing ns
    -&gt; Sing ms
    -&gt; Nested v ns (Nested v (Reverse ns ++ ms) a)
    -&gt; Nested v ms a
reduceTraceHelp = \case
    &#216;S -&gt; \_ -&gt; \case
      N&#216; y -&gt; y
    sNs' :&amp; (sN :: Sing n) -&gt; \sMs x -&gt;
      let lNs' = snocProdLength sNs'
      in  reduceTraceHelp sNs' sMs (mapNVecSlices (f sMs sNs' sN) lNs' x)
            \\ appendSnoc lNs' sN
            \\ snocReverse lNs' sN
  where
    f   :: forall o os. ()
        =&gt; Sing ms
        -&gt; SnocProd Sing os
        -&gt; Sing o
        -&gt; Nested v '[o] (Nested v ((o ': Reverse os) ++ ms) a)
        -&gt; Nested v (Reverse os ++ ms) a
    f sm sp so = collapse . diagNV' so . joinNestedVec
                    \\ prodSing (snocProdReverse sp) %:++ sm
      where
        collapse
            :: SingI (Reverse os ++ ms)
            =&gt; Nested v (o ': (Reverse os ++ ms)) a
            -&gt; Nested v (Reverse os ++ ms) a
        collapse = \case
          NS xs -&gt; sum xs
                     \\ (nesting1 Proxy :: Wit (Foldable (v o)))

diagNV'
    :: forall v n ns a. (Vec v, Nesting1 Proxy Functor v)
    =&gt; Sing n
    -&gt; Nested v (n ': n ': ns) a
    -&gt; Nested v (n ': ns) a
diagNV' s = \case
  NS (xs :: v n (Nested v (n ': ns) a)) -&gt; case vUncons s xs of
    UNil          -&gt; NS vEmpty
    UCons (s' :: Sing n')
          (y :: Nested v (n ': ns) a)
          (ys :: v n' (Nested v (n ': ns) a)) -&gt;
      case nesting1 Proxy :: Wit (Functor (v n')) of
        Wit -&gt; case diagNV' s' (NS (nTail &lt;$&gt; ys)) of
          NS zs -&gt; NS $ vCons (nHead s' y) zs

diagNV
    :: (Vec v, Nesting1 Proxy Functor v)
    =&gt; Sing n
    -&gt; Uniform n ms
    -&gt; Nested v (n ': n ': ms) a
    -&gt; Nested v '[n] a
diagNV s = \case
    U&#216;   -&gt; diagNV' s
    US u -&gt; diagNV s u . diagNV' s

itraverseNestedVec
    :: forall k (v :: k -&gt; Type -&gt; Type) (ns :: [k]) a b f. (Applicative f, Vec v)
    =&gt; (Prod (IndexN k) ns -&gt; a -&gt; f b)
    -&gt; Nested v ns a
    -&gt; f (Nested v ns b)
itraverseNestedVec f = \case
    N&#216; x  -&gt; N&#216; &lt;$&gt; f &#216; x
    NS xs -&gt; NS &lt;$&gt; vITraverse (\i -&gt; itraverseNestedVec (\is -&gt; f (i :&lt; is))) xs

    -- gmul    :: (SingI (ms ++ os), SingI (Reverse os ++ ns), SingI (ms ++ ns))
gmul'
    :: forall ms os ns v a.
     ( Nesting1 Proxy Functor     v
     , Nesting1 Sing  Applicative v
     , Nesting1 Proxy Foldable    v
     , Nesting1 Proxy Traversable v
     , SingI ns
     , SingI (Reverse os)
     , Num a
     )
    =&gt; Length ms
    -&gt; Length os
    -&gt; Length ns
    -&gt; Nested v (ms         ++ os) a
    -&gt; Nested v (Reverse os ++ ns) a
    -&gt; Nested v (ms         ++ ns) a
gmul' lM lO _ x y = joinNestedVec $ mapNVecSlices f lM x
  where
    psO :: Prod Sing (Reverse os)
    psO = singProd (sing :: Sing (Reverse os))
    f   :: Nested v os a
        -&gt; Nested v ns a
    f z = squish lO (snocProd psO) z (unjoinNestedVec (TCL.reverse' lO) y)

squish
    :: forall v os ns a.
     ( Num a
     , Nesting1 Proxy Functor     v
     , Nesting1 Sing  Applicative v
     , Nesting1 Proxy Foldable    v
     , Nesting1 Proxy Traversable v
     , SingI ns
     )
    =&gt; Length os
    -&gt; SnocProd Sing (Reverse os)
    -&gt; Nested v os a
    -&gt; Nested v (Reverse os) (Nested v ns a)
    -&gt; Nested v ns a
squish lO spO x y = (\\ reverseReverse lO)              $
                    (\\ prodSing (snocProdReverse spO)) $
    sum $ liftA2 (\x' y' -&gt; fmap (x' *) y') x (transposeHelp spO y)

transpose
    :: forall v os a.
     ( Nesting1 Proxy Functor     v
     , Nesting1 Sing  Applicative v
     , Nesting1 Proxy Foldable    v
     , Nesting1 Proxy Traversable v
     )
    =&gt; Sing os
    -&gt; Nested v os a
    -&gt; Nested v (Reverse os) a
transpose s = transposeHelp (snocProd (singProd s))

transposeHelp
    :: forall v os a.
     ( Nesting1 Proxy Functor     v
     , Nesting1 Sing  Applicative v
     , Nesting1 Proxy Foldable    v
     , Nesting1 Proxy Traversable v
     )
    =&gt; SnocProd Sing os
    -&gt; Nested v os a
    -&gt; Nested v (Reverse os) a
transposeHelp = \case
    &#216;S -&gt; \case
      N&#216; x -&gt; N&#216; x
    (sOs' :: SnocProd Sing os') :&amp; (sO :: Sing o) -&gt;
      (\\ (nesting1 Proxy :: Wit (Functor     (v o)))) $
      (\\ (nesting1 sO    :: Wit (Applicative (v o)))) $ \x -&gt;
        let lOs'  :: Length os'
            lOs'  = snocProdLength sOs'
            x' :: Nested v os' (v o a)
            x' = mapNVecSlices unVector lOs' x
                   \\ appendSnoc lOs' sO
            xT :: Nested v (Reverse os') (v o a)
            xT = transposeHelp sOs' x'
            -- TODO: analyze sequenceA vs. distribute
            y :: v o (Nested v (Reverse os') a)
            y = sequenceA xT
            y' :: Nested v '[o] (Nested v (Reverse os') a)
            y' = nVector y
        in  joinNestedVec y'
              \\ snocReverse lOs' sO


nIxRows
    :: forall k (v :: k -&gt; Type -&gt; Type) ns ms a b f. (Nesting1 Proxy Functor v, Applicative f, Vec v)
    =&gt; Length ns
    -&gt; (Prod (IndexN k) ns -&gt; Nested v ms a -&gt; f b)
    -&gt; Nested v (ns ++ ms) a
    -&gt; f (Nested v ns b)
nIxRows = \case
    LZ   -&gt; \f -&gt; fmap N&#216; . f &#216;
    LS l -&gt; \f -&gt; \case
      NS (xs :: v j (Nested v js a)) -&gt;
        fmap NS . vITraverse (\i -&gt; nIxRows l (\is ys -&gt; f (i :&lt; is) ys)) $ xs

</span></pre></body></html>